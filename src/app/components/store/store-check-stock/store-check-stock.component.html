<div class="grid">
	<div class="col-12">
		<div class="card">
			<span style="font-size: 15px; display: block; color: #0e6e13;">> {{this.menuLabel}}</span>
            <span style="font-size: 25px; display: block;">รายการสินค้าทั้งหมด STOCK A/B</span>
            <li class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap"></li>          
            <p-toast />

            <div class="p-fluid mt-2">
                <p-tabMenu 
                    [model]="items"
                    [(activeItem)]="activeItem"
                    class="my-tabmenu">
                </p-tabMenu>

                <div *ngIf="activeItem?.id === 'tab1'">
                    <div class="p-fluid p-formgrid grid mt-2">                       
                        <div class="field col-12 md:mb-0">
                            <div class="flex py-3">
                                <p-button 
                                    label="Print Stock A"
                                    icon="pi pi-file-excel"
                                    (onClick)="exportStock()" />
                            </div>
                            <p-table 
                                #historyTB
                                [value]="stockAData"
                                dataKey="product_id" 
                                [rows]="15"
                                [rowHover]="true"
                                [paginator]="true"
                                responsiveLayout="scroll"
                                [rowsPerPageOptions]="[15, 50, 100]" 
                                styleClass="p-datatable-gridlines p-datatable-striped"
                                [globalFilterFields]="['product_id', 'date_received', 'pg_id', 'product_detail', 'pu_name', 'product_remain', 'product_select_mn']"
                            >
                                <ng-template pTemplate="caption">
                                    <div class="flex justify-content-end flex-column sm:flex-row">
                                        <span class="p-input-icon-left mb-2">
                                            <i class="pi pi-search"></i>
                                            <input 
                                                pInputText 
                                                type="text" 
                                                #filter 
                                                (input)="onGlobalFilter(historyTB, $event)" 
                                                placeholder="Search Keyword" class="w-full" 
                                                id="search"/>
                                        </span>
                                    </div>
                                </ng-template>
                                <ng-template pTemplate="header">
                                    <tr>
                                    <th style="width: 5%;">
                                        <div class="flex justify-content-center align-items-center">
                                            ลำดับ
                                        </div>
                                    </th>
                                    <th pSortableColumn="date_received">
                                        <div class="flex justify-content-between align-items-center">
                                            วันที่รับ
                                            <p-sortIcon field="date_received"></p-sortIcon>
                                        </div>
                                    </th>
                                    <th pSortableColumn="pg_id">
                                        <div class="flex justify-content-between align-items-center">
                                            กลุ่ม
                                            <p-sortIcon field="pg_id"></p-sortIcon>
                                        </div>
                                    </th>
                                    <th pSortableColumn="product_id">
                                        <div class="flex justify-content-between align-items-center">
                                            รหัสสินค้า
                                            <p-sortIcon field="product_id"></p-sortIcon>
                                        </div>
                                    </th>
                                    <th pSortableColumn="product_detail">
                                        <div class="flex justify-content-between align-items-center">
                                            รายละเอียด
                                            <p-sortIcon field="product_detail"></p-sortIcon>
                                        </div>
                                    </th>
                                    <th pSortableColumn="pu_name">
                                        <div class="flex justify-content-between align-items-center">
                                            หน่วยนับ
                                            <p-sortIcon field="pu_name"></p-sortIcon>
                                        </div>
                                    </th>
                                    <th pSortableColumn="product_select_mn">
                                        <div class="flex justify-content-between align-items-center">
                                            คงเหลือจอง
                                            <p-sortIcon field="product_select_mn"></p-sortIcon>
                                        </div>
                                    </th>
                                    <th pSortableColumn="product_remain">
                                        <div class="flex justify-content-between align-items-center">
                                            คงเหลือจริง
                                            <p-sortIcon field="product_remain"></p-sortIcon>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="flex justify-content-center align-items-center">
                                            สถานะ
                                        </div>
                                    </th>
                                    <th style="width: 10%;">
                                        <div class="flex justify-content-center align-items-center">
                                            <i class="pi pi-telegram" style="color: green"></i>
                                        </div>
                                    </th>
                                </tr>
                                </ng-template>
                                <ng-template pTemplate="body" let-data let-i="rowIndex">
                                    <tr>
                                        <td class="text-center">{{i + 1}}</td>
                                        <td class="text-center">{{data.date_received || '-'}}</td>
                                        <td class="text-center">{{data.pg_id}}</td>
                                        <td>{{data.product_id}}</td>
                                        <td>{{data.product_detail}}</td>
                                        <td>{{data.pu_name}}</td>
                                        <td class="text-center">{{data.product_select_mn}}</td>
                                        <td class="text-center">{{data.product_remain}}</td>
                                        <td>
                                            <p-selectButton 
                                                [options]="stateOptions" 
                                                [(ngModel)]="data.status_usage"
                                                (onChange)="changeStatus(data, $event.value)">
                                            </p-selectButton>

                                        </td>
                                        <td>
                                            <div class="flex flex-wrap gap-3 justify-content-center">
                                                <p-button 
                                                    icon="pi pi-eye" 
                                                    [rounded]="true" 
                                                    [outlined]="true"
                                                    severity="success"
                                                    [routerLink]="['/store-check-product', data.product_id]"
                                                    [queryParams]="{ currentMenu: menuLabel2 }"
                                                    pTooltip="ดูรายละเอียด"
                                                    tooltipPosition="top" />
                                                <p-button 
                                                    icon="pi pi-pencil" 
                                                    severity="warning" 
                                                    [rounded]="true" 
                                                    [outlined]="true" 
                                                    (onClick)="showCancelDialog(data)" 
                                                    pTooltip="แก้ไข"
                                                    tooltipPosition="top" />
                                            </div>
                                        </td>
                                    </tr>
                                </ng-template>                  
                                <ng-template pTemplate="emptymessage">
                                    <tr>
                                        <td colspan="10">ไม่พบข้อมูล !!</td>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="loadingbody">
                                    <tr>
                                        <td colspan="10">กำลังโหลดข้อมูล....</td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </div>
                    </div>              
                </div>

                <div *ngIf="activeItem?.id === 'tab2'">
                    <div class="p-fluid p-formgrid grid mt-2">
                        <div class="field col-12 md:mb-0">
                            <div class="flex py-3">
                                <p-button 
                                    label="Print Stock B"
                                    icon="pi pi-file-excel"
                                    (onClick)="exportStock()" />
                            </div>
                            <p-table 
                                #historyTB2
                                [value]="stockBData"
                                dataKey="product_id" 
                                [rows]="15"
                                [rowHover]="true"
                                [paginator]="true"
                                responsiveLayout="scroll"
                                [rowsPerPageOptions]="[15, 50, 100]" 
                                styleClass="p-datatable-gridlines p-datatable-striped"
                                [globalFilterFields]="['product_id', 'date_received', 'pg_id', 'product_detail', 'pu_name', 'product_remain', 'product_select_mn']"
                            >
                                <ng-template pTemplate="caption">
                                    <div class="flex justify-content-end flex-column sm:flex-row">
                                        <span class="p-input-icon-left mb-2">
                                            <i class="pi pi-search"></i>
                                            <input 
                                                pInputText 
                                                type="text" 
                                                #filter 
                                                (input)="onGlobalFilter(historyTB2, $event)" 
                                                placeholder="Search Keyword" class="w-full" 
                                                id="search"/>
                                        </span>
                                    </div>
                                </ng-template>
                                <ng-template pTemplate="header">
                                    <tr>
                                    <th style="width: 5%;">
                                        <div class="flex justify-content-center align-items-center">
                                            ลำดับ
                                        </div>
                                    </th>
                                    <th pSortableColumn="date_received">
                                        <div class="flex justify-content-between align-items-center">
                                            วันที่รับ
                                            <p-sortIcon field="date_received"></p-sortIcon>
                                        </div>
                                    </th>
                                    <th pSortableColumn="pg_id">
                                        <div class="flex justify-content-between align-items-center">
                                            กลุ่ม
                                            <p-sortIcon field="pg_id"></p-sortIcon>
                                        </div>
                                    </th>
                                    <th pSortableColumn="product_id">
                                        <div class="flex justify-content-between align-items-center">
                                            รหัสสินค้า
                                            <p-sortIcon field="product_id"></p-sortIcon>
                                        </div>
                                    </th>
                                    <th pSortableColumn="product_detail">
                                        <div class="flex justify-content-between align-items-center">
                                            รายละเอียด
                                            <p-sortIcon field="product_detail"></p-sortIcon>
                                        </div>
                                    </th>
                                    <th pSortableColumn="pu_name">
                                        <div class="flex justify-content-between align-items-center">
                                            หน่วยนับ
                                            <p-sortIcon field="pu_name"></p-sortIcon>
                                        </div>
                                    </th>
                                    <th pSortableColumn="product_select_mn">
                                        <div class="flex justify-content-between align-items-center">
                                            คงเหลือจอง
                                            <p-sortIcon field="product_select_mn"></p-sortIcon>
                                        </div>
                                    </th>
                                    <th pSortableColumn="product_remain">
                                        <div class="flex justify-content-between align-items-center">
                                            คงเหลือจริง
                                            <p-sortIcon field="product_remain"></p-sortIcon>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="flex justify-content-center align-items-center">
                                            สถานะ
                                        </div>
                                    </th>
                                    <th style="width: 12%;">
                                        <div class="flex justify-content-center align-items-center">
                                            <i class="pi pi-telegram" style="color: green"></i>
                                        </div>
                                    </th>
                                </tr>
                                </ng-template>
                                <ng-template pTemplate="body" let-data let-i="rowIndex">
                                    <tr>
                                        <td class="text-center">{{i + 1}}</td>
                                        <td class="text-center">{{data.date_received || '-'}}</td>
                                        <td class="text-center">{{data.pg_id}}</td>
                                        <td>{{data.product_id}}</td>
                                        <td>{{data.product_detail}}</td>
                                        <td>{{data.pu_name}}</td>
                                        <td class="text-center">{{data.product_select_mn}}</td>
                                        <td class="text-center">{{data.product_remain}}</td>
                                        <td>
                                            <p-selectButton 
                                                [options]="stateOptions" 
                                                [(ngModel)]="data.status_usage"
                                                (onChange)="changeStatus(data, $event.value)">
                                            </p-selectButton>

                                        </td>
                                        <td>
                                            <div class="flex flex-wrap gap-2 justify-content-center">
                                                <p-button 
                                                    icon="pi pi-eye" 
                                                    [rounded]="true" 
                                                    [outlined]="true"
                                                    severity="success"
                                                    [routerLink]="['/store-product-detailb', data.date_input]"
                                                    [queryParams]="{ currentMenu: menuLabel2 }"
                                                    pTooltip="ดูรายละเอียด"
                                                    tooltipPosition="top" />
                                                <p-button 
                                                    icon="pi pi-pencil" 
                                                    severity="warning" 
                                                    [rounded]="true" 
                                                    [outlined]="true" 
                                                    (onClick)="showCancelDialog(data)" 
                                                    pTooltip="แก้ไข"
                                                    tooltipPosition="top" />
                                                <p-button 
                                                    icon="pi pi-trash"
                                                    [rounded]="true" 
                                                    [outlined]="true"  
                                                    (onClick)="deleteProduct(data.id, data.product_id, data.product_remain, data.stock_id)" 
                                                    severity="danger" 
                                                    pTooltip="ลบถาวร"
                                                    tooltipPosition="top" />
                                            </div>
                                        </td>
                                    </tr>
                                </ng-template>                  
                                <ng-template pTemplate="emptymessage">
                                    <tr>
                                        <td colspan="10">ไม่พบข้อมูล !!</td>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="loadingbody">
                                    <tr>
                                        <td colspan="10">กำลังโหลดข้อมูล....</td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </div>
                    </div> 
                </div>
            </div>       
        </div>     
    </div>
</div>

<div class="flex justify-content-center">
    <p-dialog header="แก้ไขจำนวนสินค้าคงเหลือ" [modal]="true" [(visible)]="visible" [style]="{ width: '70rem' }">
        <p-messages [(value)]="messages" styleClass="custom-messages"></p-messages>
        <div class="p-fluid p-formgrid grid">
            <div class="field col-12 md:mb-0">
                <label>รหัสสินค้า</label>
                    <input
                        type="text"
                        pInputText
                        [readonly]="true"
                        [value]="productId"
                    />
            </div>
            <div class="field col-12 md:mb-0">
                <label>รายการสินค้า</label>
                    <input
                        type="text"
                        pInputText
                        [readonly]="true"
                        [value]="productDetail"
                    />
            </div>
            <div class="field col-12 md:col-6 md:mb-0">
                <label>จำนวนคงเหลือในสต๊อก</label>
                    <input
                        type="text"
                        pInputText
                        [readonly]="true"
                        [value]="productRemain"
                    />
            </div>      
            <div class="field col-12 md:col-6 md:mb-0">
                <label>จำนวนที่ต้องการแก้ไข</label>
                    <input
                        type="text"
                        pInputText
                        [(ngModel)]="productEdit"
                    />
            </div>      
        </div>
        <div class="flex justify-content-end">
            <p-button 
                icon="pi pi-exclamation-circle" 
                severity="warning" 
                label="ยืนยันการแก้ไข" 
                [raised]="true"
                (click)="editProductQty(Id)"
                (onClick)="visible = false" />
        </div>      
    </p-dialog>
</div>